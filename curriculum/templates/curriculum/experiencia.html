{% extends 'curriculum/base.html' %}
{% load static %}

{% block title %}Trayectoria | {{ perfil.nombres }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto pb-20 fade-in">
    
    <!-- Encabezado Estilo Editorial -->
    <div class="mb-20 relative">
        <h2 class="text-4xl md:text-7xl font-display font-black italic uppercase tracking-tighter text-[#1a1a1a] dark:text-white leading-none">
            Trayectoria <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-purple-400">Profesional</span>
        </h2>
        <div class="h-2 w-40 bg-pink-500 mt-6 rounded-full shadow-[0_5px_15px_rgba(236,72,153,0.3)]"></div>
    </div>

    <div class="grid gap-16 relative">
        <!-- L√≠nea Cronol√≥gica Central -->
        <div class="absolute left-0 lg:left-1/2 top-0 bottom-0 w-[2px] bg-gradient-to-b from-pink-500/50 via-pink-400 to-transparent hidden md:block lg:transform lg:-translate-x-1/2"></div>
        
        {% for exp in experiencias %}
        <div class="relative flex flex-col lg:flex-row items-center justify-between group">
            
            <!-- Indicador en la l√≠nea central -->
            <div class="hidden lg:flex absolute left-1/2 top-12 -translate-x-1/2 w-12 h-12 bg-white dark:bg-zinc-800 border-4 border-pink-400 rounded-full items-center justify-center z-20 shadow-xl group-hover:scale-125 group-hover:rotate-12 transition-all duration-500">
                <span class="text-pink-500 text-xl">{% if forloop.first %}‚òÖ{% else %}‚òÜ{% endif %}</span>
            </div>

            <!-- Contenido de la Experiencia (Zig-Zag) -->
            <div class="w-full lg:w-[44%] {% if forloop.counter|divisibleby:2 %}lg:order-last lg:text-left{% else %}lg:text-right{% endif %}">
                <div class="bg-white dark:bg-zinc-900 p-10 rounded-[3.5rem] border border-gray-100 dark:border-white/5 shadow-sm hover:shadow-2xl dark:hover:shadow-pink-500/5 transition-all duration-700 relative overflow-hidden group/card">
                    
                    <!-- Resplandor decorativo -->
                    <div class="absolute -right-20 -top-20 w-40 h-40 bg-pink-500/5 rounded-full blur-3xl opacity-0 group-hover/card:opacity-100 transition-opacity duration-700"></div>

                    <!-- Cabecera de la Tarjeta -->
                    <div class="flex flex-col {% if not forloop.counter|divisibleby:2 %}lg:items-end{% else %}lg:items-start{% endif %} mb-6">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="px-5 py-1.5 bg-[#1a1a1a] dark:bg-pink-600 text-white text-[10px] font-black rounded-full uppercase tracking-widest shadow-lg font-body">
                                REG. {{ forloop.counter|stringformat:"02d" }}
                            </span>
                        </div>
                        <span class="text-pink-500 dark:text-pink-400 font-display font-black text-lg italic tracking-tight">
                            {{ exp.fecha_inicio|date:"M Y" }} ‚Äî {% if not exp.fecha_fin %}Presente{% else %}{{ exp.fecha_fin|date:"M Y" }}{% endif %}
                        </span>
                    </div>
                    
                    <h3 class="text-3xl font-display font-black uppercase text-[#1a1a1a] dark:text-zinc-100 group-hover/card:text-pink-500 transition-colors leading-none mb-3">
                        {{ exp.cargo }}
                    </h3>
                    
                    <p class="text-pink-400 font-body font-black text-[11px] uppercase mb-8 tracking-[0.2em] flex items-center {% if not forloop.counter|divisibleby:2 %}lg:justify-end{% endif %} gap-3">
                        <i data-lucide="building" size="14"></i>
                        {{ exp.empresa }} 
                        <span class="text-pink-200">‚ú¶</span> 
                        <span class="text-gray-400 font-medium lowercase italic">{{ exp.get_modalidad_display }}</span>
                    </p>
                    
                    <div class="relative">
                        <p class="text-gray-500 dark:text-gray-400 text-sm font-body leading-relaxed {% if not forloop.counter|divisibleby:2 %}lg:pl-12 lg:border-r-2 lg:border-l-0{% else %}pl-6 border-l-2{% endif %} border-pink-200 dark:border-zinc-800 italic">
                            "{{ exp.descripcion }}"
                        </p>
                    </div>

                    <!-- SECCI√ìN DE REFERENCIAS -->
                    {% if exp.nombre_contacto or exp.telefono_contacto %}
                    <div class="mt-6 {% if not forloop.counter|divisibleby:2 %}lg:pl-12{% endif %}">
                        <div class="p-4 rounded-2xl bg-pink-50/50 dark:bg-zinc-800/50 border border-pink-100 dark:border-white/5 backdrop-blur-sm">
                            <span class="text-[9px] font-black text-pink-400 uppercase tracking-widest mb-2 block flex items-center gap-2">
                                <i data-lucide="user-check" size="12"></i> Referencia Laboral
                            </span>
                            <div class="flex flex-col gap-1">
                                {% if exp.nombre_contacto %}
                                <div class="text-xs font-bold text-gray-700 dark:text-gray-200">
                                    {{ exp.nombre_contacto }}
                                </div>
                                {% endif %}
                                {% if exp.telefono_contacto %}
                                <div class="flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 font-mono">
                                    <i data-lucide="phone" size="10" class="text-pink-500"></i>
                                    {{ exp.telefono_contacto }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- BOT√ìN DE CERTIFICADO (NUEVO) -->
                    {% if exp.certificado_pdf %}
                    <div class="mt-4 {% if not forloop.counter|divisibleby:2 %}lg:pl-12{% endif %}">
                        <a href="{{ exp.certificado_pdf.url }}" target="_blank" class="inline-flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-zinc-800 text-gray-600 dark:text-gray-300 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-pink-500 hover:text-white dark:hover:bg-pink-600 transition-all group/cert">
                            <i data-lucide="file-check" class="w-4 h-4 group-hover/cert:scale-110 transition-transform"></i>
                            Ver Constancia Laboral
                        </a>
                    </div>
                    {% endif %}

                    <!-- Detalle visual inferior -->
                    <div class="absolute bottom-6 {% if not forloop.counter|divisibleby:2 %}left-8{% else %}right-8{% endif %} opacity-0 group-hover/card:opacity-20 transition-all duration-700">
                        <span class="text-6xl text-pink-500">êôö</span>
                    </div>
                </div>
            </div>

            <!-- Espaciador para la columna opuesta -->
            <div class="hidden lg:block lg:w-[44%]"></div>
        </div>
        {% empty %}
        <!-- Estado Vac√≠o -->
        <div class="bg-white dark:bg-zinc-900 p-20 rounded-[5rem] border-2 border-dashed border-pink-200 dark:border-zinc-800 text-center col-span-full">
            <div class="w-24 h-24 bg-pink-50 dark:bg-white/5 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner animate-bounce">
                <i data-lucide="flower" class="text-pink-400" size="48"></i>
            </div>
            <h4 class="text-[#1a1a1a] dark:text-white font-display font-black text-2xl uppercase tracking-tighter mb-2">Sembrando el camino</h4>
            <p class="text-gray-400 font-body italic">A√∫n no se han registrado experiencias en esta bit√°cora creativa.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Call to Action -->
    <div class="mt-24 text-center">
        <p class="text-pink-500 font-black uppercase tracking-[0.4em] text-[10px] mb-8 font-body">Ready for the next big thing?</p>
        <a href="{% url 'contacto' %}" class="inline-flex items-center gap-4 px-12 py-6 bg-[#1a1a1a] dark:bg-pink-600 text-white font-black rounded-full shadow-2xl hover:scale-105 hover:bg-pink-500 transition-all duration-500 uppercase text-[11px] tracking-widest font-body">
            Hablemos de nuevos proyectos <i data-lucide="message-circle" size="18"></i>
        </a>
    </div>
</div>

<style>
    /* Animaci√≥n de entrada escalonada para las tarjetas usando el counter de Django */
    .group { animation: slideIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) both; }
    {% for exp in experiencias %}
    .group:nth-child({{ forloop.counter }}) { animation-delay: {{ forloop.counter|add:"0.2" }}s; }
    {% endfor %}

    @keyframes slideIn {
        from { opacity: 0; transform: translateY(40px) scale(0.95); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }
</style>
{% endblock %}